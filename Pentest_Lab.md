---
title: Pentest Lab
permalink: /Pentest_Lab/
---

# Pentest Lab

Installation
------------

-   Installer virtualbox
-   Télécharger les ISOs sur <https://www.microsoft.com/fr-fr/evalcenter/evaluate-windows-server-2012-r2>
-   Configurer la carte réseau de la machine pour utiliser le mode "Host-Only"
-   Activer la licence (slmgr /ato pour l'activer, slmgr /dlv pour voir le nombre de jours restants)
-   Sauvegarder la VM sous le nom de "template"

-   Lors du déploiement à partir d'un template (via un clone)
  -   Bien penser à changer l'adresse MAC de la VM si on fait un clone
  -   Mettre une IP Statique, définir l'AD en tant que serveur DNS et désactiver l'IPv6
  -   Faire un sysprep avc l'option "Generalize" pour corriger les problèmes de SID identiques (C:\Windows\System32\Sysprep)
  -   Joindre le domaine et changer le hostname (https://technet.microsoft.com/en-us/library/cc770919(v=ws.10).aspx)

S'il y a des problèmes de d'approbation c'est potentiellement dû à une mauvaise synchronisation du mot de passe de la machine entre le serveur et l'AD. La commande suivante permet de le renouveller:
```
netdom resetpwd /s:server2 /ud:mon_domaine\administrator /pd:*
```


## Serveurs
Le lab est actuellement constitué de deux forêts ("SHINRA-INC" et "GOLDSAUCER). 

Les serveurs suivants sont installés:
- MIDGAR (XXX.XXX.XXX.XXX): Windows Server 2012 R2 avec le rôle Active Directory pour SHINRA-INC
- CHOCOBO (XXX.XXX.XXX.XXX): Windows Server 2012 R2 avec le rôle Active Directory pour GOLDSAUCER

Une trust bi-directionelle inter-forêt est établie.


Références
----------

- [Setting up a Windows Lab Environment](http://thehackerplaybook.com/Windows_Domain.htm)
- [Building an Effective Active Directory Lab Environment for Testing ](https://adsecurity.org/?p=2653)
- [Pentesting Active Directory](https://scriptdotsh.com/index.php/tag/pentesting-active-directory/)
